<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Financial Dashboard</title>
<link rel="stylesheet" type="text/css" href="../CSS/personalReport.css">
</head>
<body>
    <a href="/template" class="custom-icon">
        <!-- You can use an image or any other HTML element for your custom icon -->
        <img src="../back.jpeg" alt="Custom Icon">
    </a>
<div class="header">
    <h1>Welcome, <span id="username"></span>!</h1>
    <h2>Current Balance: $<span id="balance"></span></h2>
</div>
<div class="container">
    <h2>Transaction History:</h2>
    <div id="transactionContainer" class="transaction-container">
        <!-- Transaction items will be added dynamically here -->
    </div>
</div>
<script src="../JavaScript/personalReport.js">personalReport()</script>
<script>
    window.onload = function() {
        fetchTransactions();
    };
    function fetchTransactions() {
        
    const myHeaders = new Headers();
    myHeaders.append("x-auth-token", "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2NjIwMTAyNDA5ODdhMDIyNzViODMxZmEiLCJpYXQiOjE3MTM3MjEzODMsImV4cCI6MTcxMzcyMjI4M30.3qlRwK0_34ZWK_OP3JVPBvYw7iF5qS2iDinOXMkh4IE");
    myHeaders.append("Content-Type", "application/json");

    //console.log("HERE", req.cookies.token)
   
    // Fetch user data using the token in the headers
    fetch("http://52.158.43.53:8080/api/users/info", {
        headers: myHeaders
    })
    .then((response) => {
        if (!response.ok) {
            throw new Error('Failed to fetch user data');
        }
        return response.json(); // Parse response body as JSON
    })
    .then((data) => {
        console.log("User Data:", data.name); // Print user data to console
        document.getElementById("username").textContent = data.name
    })
    .catch((error) => console.error(error));


    const raw = "";
    const requestOptions = {
    method: "GET",
    headers: myHeaders,
    // body: raw,
    redirect: "follow"
    };

    fetch("http://52.158.43.53:8080/api/transactions/fetch", requestOptions)
    .then((response) => response.text())
    .then((data) => {
        console.log("Response Data:", data); 
        const obj = JSON.parse(data)

        var transactionContainer = document.getElementById("transactionContainer");

        //Clear existing transactions
        transactionContainer.innerHTML = "";

        obj.forEach(function(transaction) {
            var transactionItem = document.createElement("div");
            transactionItem.classList.add("transaction-item");
            transactionItem.innerHTML = `
                <p>Date: ${new Date(transaction.TransactionDate)}</p>
                <p>Merchant: ${userName}</p>
                <p>Expenses: $${transaction.TransactionAmount}</p>
            `;
            transactionContainer.appendChild(transactionItem);
        });

    })
    .catch((error) => console.error(error));

    }
</script>                  
     
</body>
</html>
